# The proposal
<!--
This is where the proposal should be outlined. 
-->

## Overview
<!--
At a high-level address what your proposal is and how it will address the problem identified. Highlight any benefits to the R Community that follow from solving the problem. This should be your most compelling section.
-->

Based on years of experience, and broad feedback from the movement
community, we aim to develop a central trajectory class to support all
stages of movement studies (pre-processing, post-processing and
analysis). We propose a `sftraj` package offering a generic and
flexible approach . The only aim of the package will be to present
this central class and basic functions to build, handle, summarize and
plot movement data. Our project relies on three complementary pillars:
a broad involvement of the movement community, a robust conceptual
data model, and a `sf`-based implementation in R. <!-- ` -->


## Detail
<!--
Go into more detail about the specifics of the project and it delivers against the problem.

Depending on project type the detail section should include:

 - [ ] Minimum Viable Product
 - [ ] Architecture
 - [ ] Assumptions
-->


### Definitions

A *trajectory* can be defined as the (continuous) curve made by moving
objects (Turchin 1998, Fig. 2). In practice, this curve is sampled
(recorded) at discrete times to collect a 4D *location* (vertices
composed of 3-dimensional spatial coordinates plus the temporal
coordinate), which define *tracking data* of the form $(x, y, z, t)$,
or, according to Turchin (1998), a *path*, i.e. the "complete
spatio-temporal record of a followed organism, from the beginning to
the end of observations".

```{r definitions, echo = FALSE, out.width = "50%", fig.cap = "Definition of elements of movement.", fig.align = "center"}
knitr::include_graphics("figures/definitions.png")
```

Considering the temporal autocorrelation between successive locations
as part of the movement information (Martin *et al.* 2009), we can
then defines *steps* as the straight-line segments between two
successive locations. Treating movement steps as straight lines is an
"idealization" and the most parsimonious approach (other complex
approaches exist in some fields, such as splines and Bezier curves),
but at sufficient resolution, no significant information is lost.

Movement is thus recorded by a series of locations in a path, and is
abstracted as sequential steps in a trajectory. It is important to
recognize this dual perspective, between tracking data (locations) and
movement data (steps) (Fig. 1).


### Conceptual data model

A data model is an abstract model that organizes elements of data and
standardizes how they relate to one another and to properties of the
real world entities (here a moving object). 


The trajectory is the continuous curve traced by the movement of an
object through time (Fig.1A). In practice, a trajectory is sampled at
given times with 4-dimensional vertices of coordinates 
$(x, y [, z], t)$, which define a path made of sequential steps, i.e. the
straight-line segment connecting two successive vertices. Conceptual
models of movement, from Turchin 1998 to Nathan et al. 2008, consider
the step as the elementary unit of movement, which scale up to
movement modes, movement phases, and all the way up to the individual
lifetime track (Fig. 2).

```{r data-model, echo = FALSE, out.width = "80%", fig.cap = "Proposed conceptual model.", fig.align = "center", fig.pos = "!t"}
knitr::include_graphics("figures/conceptual-model.png")
```


### Implementation in R

The elementary unit of movement, the step, is at the core of the
logical data model (Fig. 3). Data are provided as tidy data, in a data
frame of observations (rows) and variables (columns). One of the
variables is the step column which stores one or several trajectories,
and is composed of steps. The step is the elementary observation and
contains all (and only) 4D-coordinates of the segment of
line. Ancillary data measured at the beginning or along the step can
be stored as additional variables, some of them potentially defining
trajectory nesting, in case of several trajectories being stored in
the step column.

```{r implementation, echo = FALSE, out.width = "70%", fig.cap = "Proposed implementation.", fig.align = "center"}
knitr::include_graphics("figures/implementation.png")
```

based on simple `data.frame`s using `sf` spatial
building blocks, as a cornerstone for the development of a more
cohesive movement community in R

   
The data model of a trajectory is a model — it is thus an idealized 
representation of steps forming a path. The implementation aims at
using existing building blocks as much as possible, as to not reinvent
the wheel, and allow to use existing tools and functions on these
building blocks.

`sf` provides the core spatial classes. Tracking data can be
considered as `POINTS [Z]M`, i.e. points with longitude, latitude,
optionally altitude, and timestamps. If the exact time of the location
is known, timestamps can be stored as `POSIXct`. Two successive
`POINTS [Z]M` define a `LINESTRING [Z]M`, i.e. the straightline
segment between two successive locations.

The `data.frame` storing a set of trajectories will be a `sf` object,
of class `c("sftraj", "sf", "data.frame")`. The step column
(list-column) will be of class `sfc_TRAJECTORY`, with a unique
Coordinate Reference System (CRS) and timezone in the two (constant)
attributes `crs` and `timezone`, respectively.

A single `sftraj` object can be a single trajectory, or a set of
trajectories (all trajectories then share the same CRS and
timezone). Nesting is an essential part of the data model, as it
allows any user-defined boundaries of a trajectory, e.g. at the
individual level, or (behavioral) state, or year, etc. (including
nested levels, such as individual-year).

Ideally, the `sfc_TRAJECTORY` should behave as a `MULTILINESTRING [Z]`
or a `POSIXct` whenever needed (i.e. only $(x,y)$ or $(t)$ are
extracted and used). For instance:
  * plot functions will most often use only 2D coordinates of vertices
    combined;
  * time functions will work on the time coordinate.




<!-- ∘ attribute "singletons" for 010 points -->


<!-- ### Work in progress -->

<!-- See GitHub issues. -->

<!-- Note (from Mathieu Basille): Check [attribute-geometry-relationship](https://r-spatial.github.io/sf/articles/sf6.html#how-does-sf-deal-with-secondary-geometry-columns), -->
<!-- and how this could be used for interpolation. -->
